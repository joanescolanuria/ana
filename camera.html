<!DOCTYPE html>
<html>
<head>
  <title>Superponer Joya en Cuello</title>
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs"></script>
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/blazepose"></script>
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs-backend-webgl"></script>
</head>
<body>
  <h1>Superponer Joya en Cuello</h1>
  <select id="joya-selector">
    <option value="imagen1.png">Joya 1</option>
    <option value="imagen2.png">Joya 2</option>
  </select>
  <button id="start-button">Iniciar</button>
  <video id="video" width="640" height="480" autoplay></video>
  <canvas id="canvas" width="640" height="480"></canvas>

  <script>
    let video = document.getElementById('video');
    let canvas = document.getElementById('canvas');
    let ctx = canvas.getContext('2d');
    let joyaImage = new Image();

    async function setupCamera() {
      const stream = await navigator.mediaDevices.getUserMedia({
        video: true
      });
      video.srcObject = stream;

      return new Promise((resolve) => {
        video.onloadedmetadata = () => {
          resolve(video);
        };
      });
    }

    async function loadBlazePose() {
      return await blazepose.load();
    }

    function getJoyaPosition(pose) {
      const nose = pose.keypoints.find(point => point.name === 'nose');
      const leftShoulder = pose.keypoints.find(point => point.name === 'left_shoulder');
      const rightShoulder = pose.keypoints.find(point => point.name === 'right_shoulder');

      if (nose && leftShoulder && rightShoulder) {
        const x = nose.x;
        const y = (leftShoulder.y + rightShoulder.y) / 2;

        return { x, y };
      }

      return null;
    }

    async function startApp() {
      const joyaSelector = document.getElementById('joya-selector');
      joyaImage.src = joyaSelector.value;
      <!DOCTYPE html>
    <html>
    <head>
      <title>Superponer Joya en Cuello</title>
      <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs"></script>
      <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/blazepose"></script>
      <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs-backend-webgl"></script>
    </head>
    <body>
      <h1>Superponer Joya en Cuello</h1>
      <select id="joya-selector">
        <option value="imagen1.png">Joya 1</option>
        <option value="imagen2.png">Joya 2</option>
      </select>
      <button id="start-button">Iniciar</button>
      <video id="video" width="640" height="480" autoplay></video>
      <canvas id="canvas" width="640" height="480"></canvas>

      <script>
        let video = document.getElementById('video');
        let canvas = document.getElementById('canvas');
        let ctx = canvas.getContext('2d');
        let joyaImage = new Image();

        async function setupCamera() {
          const stream = await navigator.mediaDevices.getUserMedia({
            video: true
          });
          video.srcObject = stream;

          return new Promise((resolve) => {
            video.onloadedmetadata = () => {
              resolve(video);
            };
          });
        }

        async function loadBlazePose() {
          return await blazepose.load();
        }

        function getJoyaPosition(pose) {
          const nose = pose.keypoints.find(point => point.name === 'nose');
          const leftShoulder = pose.keypoints.find(point => point.name === 'left_shoulder');
          const rightShoulder = pose.keypoints.find(point => point.name === 'right_shoulder');

          if (nose && leftShoulder && rightShoulder) {
            const x = nose.x;
            const y = (leftShoulder.y + rightShoulder.y) / 2;

            return { x, y };
          }

          return null;
        }

        async function startApp() {
          const joyaSelector = document.getElementById('joya-selector');
          joyaImage.src = joyaSelector.value;

          await setupCamera();
          const net = await loadBlazePose();

          video.play();

          async function detectPose() {
            const poses = await net.estimatePoses(video, {
              flipHorizontal: false,
              decodingMethod: 'single-person'
            });

            ctx.drawImage(video, 0, 0, 640, 480);

            if (poses.length > 0) {
              const pose = poses[0];
              const joyaPosition = getJoyaPosition(pose);

              if (joyaPosition) {
                const neckWidth = Math.abs(pose.keypoints[5].x - pose.keypoints[6].x);
                const scale = neckWidth / joyaImage.width;

                ctx.save();
                ctx.translate(joyaPosition.x, joyaPosition.y);
                ctx.scale(scale, scale);
                ctx.drawImage(joyaImage, -joyaImage.width / 2, 0);
                ctx.restore();
              }
            }

            requestAnimationFrame(detectPose);
          }

          detectPose();
        }

        document.getElementById('start-button').addEventListener('click', startApp);
      </script>
    </body>
    </html>

      await setupCamera();
      const net = await loadBlazePose();

      video.play();

      async function detectPose() {
        const poses = await net.estimatePoses(video, {
          flipHorizontal: false,
          decodingMethod: 'single-person'
        });

        ctx.drawImage(video, 0, 0, 640, 480);

        if (poses.length > 0) {
          const pose = poses[0];
          const joyaPosition = getJoyaPosition(pose);

          if (joyaPosition) {
            const neckWidth = Math.abs(pose.keypoints[5].x - pose.keypoints[6].x);
            const scale = neckWidth / joyaImage.width;

            ctx.save();
            ctx.translate(joyaPosition.x, joyaPosition.y);
            ctx.scale(scale, scale);
            ctx.drawImage(joyaImage, -joyaImage.width / 2, 0);
            ctx.restore();
          }
        }

        requestAnimationFrame(detectPose);
      }

      detectPose();
    }

    document.getElementById('start-button').addEventListener('click', startApp);
  </script>
</body>
</html>
